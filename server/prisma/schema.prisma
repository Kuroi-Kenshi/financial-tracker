generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int                  @id @default(autoincrement())
  email              String               @unique
  password           String
  name               String
  avatarPath         String               @default("default-avatar.png") @map("avatar_path")
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  balance            Float                @default(0)
  hashedRefreshToken String?              @map("hashed_refresh_token")
  UserBalance        UserBalance[]
  Expense            Expense[]
  Income             Income[]
  Investment         Investment[]
  ExpenseCategory    ExpenseCategory[]
  IncomeCategory     IncomeCategory[]
  InvestmentCategory InvestmentCategory[]
  Counterpart        Counterpart[]
  Debt               Debt[]
  Credit             Credit[]
  FinancialGoal      FinancialGoal[]
  BudgetPlan         BudgetPlan[]
}

model UserBalance {
  id         Int      @id @default(autoincrement())
  balance    Float
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  user       User     @relation(fields: [userId], references: [id])
  userId     Int      @map("user_id")
  currency   Currency @relation(fields: [currencyId], references: [id])
  currencyId Int      @map("currency_id")
}

model Currency {
  id            Int             @id @default(autoincrement())
  code          String          @unique
  name          String
  symbol        String
  Expense       Expense[]
  Income        Income[]
  Investment    Investment[]
  Credit        Credit[]
  Debt          Debt[]
  FinancialGoal FinancialGoal[]
  BudgetPlan    BudgetPlan[]
  UserBalance   UserBalance[]
}

model Expense {
  id              Int              @id @default(autoincrement())
  name            String
  amount          Float
  date            DateTime
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  user            User             @relation(fields: [userId], references: [id])
  userId          Int              @map("user_id")
  categoryExpense ExpenseCategory? @relation(fields: [categoryId], references: [id])
  categoryId      Int?             @map("category_id")
  receipt         Receipt[]
  currency        Currency         @relation(fields: [currencyId], references: [id])
  currencyId      Int              @map("currency_id")
}

model Receipt {
  id           Int      @id @default(autoincrement())
  originalName String   @map("original_name")
  fileName     String   @map("file_name")
  size         Int
  mimetype     String   @map("mime_type")
  filePath     String   @map("file_path")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  Expense      Expense  @relation(fields: [expenseId], references: [id])
  expenseId    Int      @map("expense_id")
}

model Income {
  id             Int             @id @default(autoincrement())
  name           String
  amount         Float
  date           DateTime
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")
  user           User            @relation(fields: [userId], references: [id])
  userId         Int             @map("user_id")
  categoryIncome IncomeCategory? @relation(fields: [categoryId], references: [id])
  categoryId     Int?            @map("category_id")
  currency       Currency        @relation(fields: [currencyId], references: [id])
  currencyId     Int             @map("currency_id")
}

model Investment {
  id                 Int                 @id @default(autoincrement())
  name               String
  amount             Float
  date               DateTime
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  user               User                @relation(fields: [userId], references: [id])
  userId             Int                 @map("user_id")
  categoryInvestment InvestmentCategory? @relation(fields: [categoryId], references: [id])
  categoryId         Int?                @map("category_id")
  currency           Currency            @relation(fields: [currencyId], references: [id])
  currencyId         Int                 @map("currency_id")
}

model ExpenseCategory {
  id          Int                         @id @default(autoincrement())
  name        String                      @unique
  color       String
  expenses    Expense[]
  user        User                        @relation(fields: [userId], references: [id])
  userId      Int                         @map("user_id")
  budgetPlans BudgetPlanExpenseCategory[]
}

model IncomeCategory {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  color   String
  incomes Income[]
  user    User     @relation(fields: [userId], references: [id])
  userId  Int      @map("user_id")
}

model InvestmentCategory {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  color       String
  investments Investment[]
  user        User         @relation(fields: [userId], references: [id])
  userId      Int          @map("user_id")
}

model Counterpart {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  debt        Debt[]
  credit      Credit[]
  user        User     @relation(fields: [userId], references: [id])
  userId      Int      @map("user_id")
}

model Debt {
  id            Int                 @id @default(autoincrement())
  description   String?
  amount        Float
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")
  dueDate       DateTime?
  status        DebtAndCreditStatus
  totalPayments Float               @map("total_payments")
  debtor        Counterpart         @relation(fields: [debtorId], references: [id])
  debtorId      Int
  user          User                @relation(fields: [userId], references: [id])
  userId        Int                 @map("user_id")
  currency      Currency            @relation(fields: [currencyId], references: [id])
  currencyId    Int                 @map("currency_id")
}

model Credit {
  id            Int                 @id @default(autoincrement())
  description   String?
  amount        Float
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")
  dueDate       DateTime?
  status        DebtAndCreditStatus
  totalPayments Float               @map("total_payments")
  creditor      Counterpart         @relation(fields: [creditorId], references: [id])
  creditorId    Int
  user          User                @relation(fields: [userId], references: [id])
  userId        Int                 @map("user_id")
  currency      Currency            @relation(fields: [currencyId], references: [id])
  currencyId    Int                 @map("currency_id")
}

model FinancialGoal {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String
  amount      Float
  totalAmount Float
  deadline    DateTime
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  user        User     @relation(fields: [userId], references: [id])
  userId      Int      @map("user_id")
  currency    Currency @relation(fields: [currencyId], references: [id])
  currencyId  Int      @map("currency_id")
}

model BudgetPlan {
  id                Int                         @id @default(autoincrement())
  name              String                      @unique
  description       String
  amount            Float
  createdAt         DateTime                    @default(now()) @map("created_at")
  updatedAt         DateTime                    @updatedAt @map("updated_at")
  user              User                        @relation(fields: [userId], references: [id])
  userId            Int                         @map("user_id")
  currency          Currency                    @relation(fields: [currencyId], references: [id])
  currencyId        Int                         @map("currency_id")
  expenseCategories BudgetPlanExpenseCategory[]
}

model BudgetPlanExpenseCategory {
  expenseCategory   ExpenseCategory @relation(fields: [expenseCategoryId], references: [id])
  expenseCategoryId Int             @map("expense_category_id")
  budgetPlan        BudgetPlan      @relation(fields: [budgetPlanId], references: [id])
  budgetPlanId      Int             @map("budget_plan_id")

  @@id([expenseCategoryId, budgetPlanId])
}

enum DebtAndCreditStatus {
  ACTIVE
  PAID
  CANCELLED
}
